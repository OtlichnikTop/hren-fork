#!/bin/bash

focused=true
fullscreen=false

while :; do
	active_window=$(xdotool getactivewindow)

	#Monitor active window
	xprop -id $active_window -spy _NET_WM_STATE |
		while read line; do
			#echo $active_window $line $fullscreen
			[[ "$line" != *"FOCUSED"* ]] && focused=false #Window lost focus

			if $focused && [[ "$line" == *"FULLSCREEN"* ]]; then
				if ! $fullscreen; then
					echo "Screensaver disabled"

					#Window state changed to fullscreen
					fullscreen=true
					xset s off
					xset -dpms
				fi
			elif $fullscreen; then
				echo "Screensaver enabled"

				#Window no longer fullscreen
				fullscreen=false
				xset s on
				xset +dpms
			fi

			! $focused && kill $!
		done &
	wait $!
done
